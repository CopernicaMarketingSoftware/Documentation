# Security of a webhook

To prevent your confidential information from being intercepted and to protect your sensitive data, you can specify
a https endpoint so that all data will be encrypted. However, security doesn't stop there.

Usually, endpoints are open to the world. This means that anyone with the url has access
to it. To verify that a request is actually generated by SMTPeter and not a third-party that pretends to be someone else, SMTPeter signs the request headers. In this way, users can verify that requests are generated by our services.  

## Headers

### Digest

The `Digest` header is added in compliance with [RFC 3230](https://tools.ietf.org/html/rfc3230#section-4.3.2).
This can be used to verify message data integrity. 

### X-Copernica-ID

An identifier for your SMTPeter environment is added. The header will contain the data in the 
form of `X-Copernica-ID: environment_<number>`. 

### Signature

The headers are signed using a draft for a standard of signing HTTP messages, which you can
find [here](https://tools.ietf.org/html/draft-cavage-http-signatures-10).

As a `keyId`, an url is provided in which a key can be found in the TXT record. Currently, the field contains
a full URL which can be queried for a `TXT` record, where a valid DKIM key can be found. To improve security, 
these keys automatically rotate.

As an additional security measure, the headers in the signature should at least contain the following fields
- `(request-target)` - the target resource, e.g. `/path/to/your/script.php`
- `Host` - the hostname
- `Date` - the date this request was created at
- `X-Copernica-ID` - the environment identifier, see above
- `Digest` - the message digest, see above

Verifying all these headers will ensure that the full message is from SMTPeter, that the message is recent
(which prevents replay attacks), that this is actually a message for your endpoint and that this message
is actually meant for your account. Because of the `Digest` header, the integrity of the message body can 
be checked.

### Example

You can find an example implementation of correct message verification [here](https://github.com/CopernicaMarketingSoftware/webhook-security).

## More information

* [Webhooks](./webhooks)


